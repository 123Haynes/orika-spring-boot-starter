machine:
  java:
    version: "oraclejdk8"

dependencies:
  override:
    - |
      mvn --batch-mode clean install --activate-profiles skip-tests
  cache_directories:
    - "~/.m2"

test:
  override:
    - |
      mvn --batch-mode test site
  post:
    - |
      cd target && \
        find -maxdepth 1 -type f -name \*.jar -exec cp --parents {} ${CIRCLE_ARTIFACTS} \; \
        ||:
    - |
      cd target/site && \
        mkdir ${CIRCLE_ARTIFACTS}/site && \
        find -type f -exec cp --parents {} ${CIRCLE_ARTIFACTS}/site \; \
        ||:
    - |
      cd target/surefire-reports && \
        find -type f -name *.xml -exec cp --parents {} ${CIRCLE_TEST_REPORTS}/junit \; \
        ||:
